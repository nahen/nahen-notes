---
created: 2024-06-16
modified: 2024-07-30
tags: []
aliases: []
parents: 
---
%%ここ数ヶ月間、英語を勉強し続けている。LLMのような生成AIを効果的に使うには、英語が扱えた方がよいと思っているからだ。というのも、LLMを制作しているのは英語圏の企業であり、英語の言語データセットの量が一番多いというLLMも多数ある。それならば、英語を扱える人間になればLLMを効果的に扱えるのかもしれない。
なお、LLMが普及しない世の中になっても問題はない。英語が使えることは依然として有用なスキルの一つだろう。%%
## 英英辞典からAnkiカードを効率的に作りたい
現在は[[🌐Antimoon Method]]に則って、英語を勉強している。使用するのは、ロングマン英英辞典に載っている例文とその日本語訳だ。  
これらの例文と音声を合わせて、単語帳アプリ[[🧰Anki]]に突っ込んでいる。そして時間がある時に、単語帳を繰るようにその例文集を繰って、例文や単語の意味を脳に覚え込ませようとしている。

これまでは、このAnki用のカードを作る工程を手作業で行っていた。しかしカードを一枚一枚作っていく工程は想像よりも時間がかかる。そのため、プログラミングを使ってこの作業を効率化できないかと考えた。
## Chrome拡張機能を作る
まず最初に、どうやってロングマン英英辞典のWEBサイトから例文や例文音声、そして英単語とその情報を取得するか。以前に似たようなWEBスクレイピングを行ったことがあり、その時はPythonとBeautiful Soupを使った。

しかし、今回はブラウザを操作するわけでも、WEBページ全体をスクレイピングするつもりではない。そのため、Pythonを使ってプログラミングをするのは少し大袈裟な気もする。[^結果的には]もし他に良い手法があるならば、そちらを実践したい。

[^結果的には]: 最終的には、WEBページ全体をスクレイピングする必要が出た。人間の予想はいつだって外れる。

一人で考えていても埒が開かなかったので、LLMに相談した。「WEBサイトからテキストを抜き出すプログラムを書くのに適した言語はあるでしょうか？」その返答の中に、JavaScriptを使うという案があった。そこから、Chrome拡張機能として作るという案に思い至った。

## 実装する機能
今回私が作ろうとしたのは、以下の機能だ。
- *特定の*例文を取得する
- 対象の例文が載っている英単語とその定義を取得する
- 例文の音声と、英単語の発音2種類をダウンロードする

普段作っているAnkiのカードは、英単語に関連するすべての例文をすべて取り込んでいるわけではなく、特定の例文だけを取り込んでいる。[^なぜ特定のものだけ？]そして、載せる例文は自分で選択したい。そのため、載っている例文のうち、選択した一部だけを集めるという方法で進める。[^別の方法の方が良かったかも]

そして英単語については発音記号や品詞、活用や文法上の使い方など、付属する情報も取得したい。

余談だが、この「付随する情報」が自分の思っていた以上に種類が多く、コードを書く際にも苦労することになった。手作業でやっていた時は、ブラウザに写っているものを丸ごとコピーするだけで済んでいたのだが。

[^なぜ特定のものだけ？]: 基本的には、ロングマン英英辞典とロングマン和英辞典とで共通している例文を中心に取り上げている。自分が生み出した和訳よりも、辞書に載っている和訳の方が信憑性があると思っているからだ。しかし、和英辞典と英英辞典とで共通に載っている例文は少ない。場合によっては、例文はほぼ共通しているが、代名詞や数値の単位だけが異なるというパターンもある。
[^別の方法の方が良かったかも]: 機能を作成し終えてから、「あらかじめすべての例文を抽出してTSVファイルに出力し、使えそうな例文だけピックする」という手法を思いついた。初めからそうすれば良かったと思う。

しかし、私自身はChrome拡張機能を作るのが初めてだ。そもそも、どういうふうに作ればいいのかがわからない。そこで、拡張機能の作り方はGoogle検索で出てきたサイトを参考に実施した。[^拡張機能の作り方]

[^拡張機能の作り方]: [Chrome拡張機能を作ってみる（基礎） - Qiita](https://qiita.com/komlabo/items/5b99d3598f6664621dae)

## LLMによる開発補助はとても便利
また、今回の開発作業では初めてLLMを使うことにした。LLMはプログラマーをどこまでサポートできるのか？　それを実際に試して知りたかったからだ。

最初に、ロングマン英英辞典のHTMLの一部をコピーして貼り付けて、そのHTMLから特定のClassを持つテキストを取得するコードを作成するようにLLMに頼んだ。  
今回使用したLLMはClaude3がメインで、Claude3だけではわからない部分はGeminiを使った。

何度かやりとりを繰り返して得た感想としては、「思っていたよりもすごい」というものだった。探索対象のHTMLと、そのHTMLから何を得たいか。それらを日本語で伝えるだけでも、LLMは使えそうなJavaScriptコードを生成してくれる。その速度は私の知る中で誰よりも早い。私はコードを書くのが非常に遅いので、光の速度で置き去りにされてしまった。

一方で、たった一回の応答だけで完璧なコードが生成されるわけではない。出力したコードを実行してもエラーが出たり、想定とは違う形でテキストが取得してきたり、不要なプラグインを使おうとしたりする。

幸い、そんな場合でも修正は簡単にできる。エラーメッセージ等を余さずLLMに伝えて、修正するように指示するだけでいい。それだけでLLMは、追加の要望を叶えるコードを新たに生成してくれる。

たった一回で完璧なコードが作れないのは不便だなあと思う。しかし、これには当然といえば当然の理由がある。LLMの性能が悪いのではない。むしろそれ以前、つまり私側の問題だ。

少なくとも私は、たった一回でLLMが完璧に働くような指示が出せない。なぜなら、*自分が作ろうとしているものの要件を具体的に定義できていない*からだ。

LLMとのやりとりを続ければ続けるほど、自分の要件の穴が見えてくる。自分の中で言語化できていなかった前提や、「これは説明しなくてもわかってくれるだろう」と思って重要な説明を端折ったりしてしまう。

LLMにコードを出力してもらう上で大事なことは、*自分が作りたいモノの要件を言語化できるまで具体的に固める*ことだ。だからこそ、たった一回の指示だけで完璧なコードを作ろうとしてはならない。

それよりもLLMと対話を繰り返すことで、自分の要件の穴を埋めながら、コードを少しずつ自分の理想の形に近づけるやり方が望ましい。LLMを使ってみて、改めてそう思う。

%%要件を定義することは難しい。多くの場合、LLMが思っていたようなコードを生成してくれないのは、LLMが悪いというよりはむしろ自分の指示が悪いことが原因だ。前提条件を伝えなかったせいで、Chrome拡張機能で使えないプラグインを使いだす。本当は「音声が存在する例文」だけを取得するのが要件なのに、その説明を省いて「例文」とだけ伝えたせいで、コーパス内の文章まで集めようとする。こうして説明の、主に不足によって、LLMは自分の想定とは違うコードを作り出してしまう。%%

そして、LLMが生成するコードはそこそこの品質がある。少なくともプログラミング初心者が書くコードより綺麗だ。というか、今の私より良いコードを書く場合もある。私としてはそちらの方が怖い。[^私はオブジェクト志向が書けない]

[^私はオブジェクト志向が書けない]: プログラマーとして数年働いた経験はあるのに、私はオブジェクト志向がどのような概念なのか理解できていない。これまで書いてきたコードも、オブジェクト志向というより手続き型に近い。

%%
生成AIが広まることで置き換えられる可能性が高いのは、私のように実務経験が数年程度の中間層だと思う。生成AIは初心者に優しい。何をすればよいかわからなければ、生成AIはステップごとの進め方を教えてくれる。質問があれば四六時中いつでも答えてくれる。
一方で、上級者が生成AIから技術を教わることはあまりない。しかし、自身の得意分野以外の面で生成AIを活用できる。形而上的なアイデアについて生成AIと壁打ちをすれば、自分の考えの補強・穴埋めを効果的に進められる。

ところが、中間層はそのどちらの恩恵も受け取りづらい。初心者よりは知識や経験があるため、何か困ったことがあっても自力で解決しようとするので、生成AIを頼りづらい。そして上級者ほど知識や経験があるわけではないので、生成AIにアイデアを伝えようとしても、漠然としたものになりやすい。（本当か？）

その上で、生成AIが生み出すコードの品質は中級者に近い。しかも、中級者よりも早く、正確に、大量のコードを生み出してくれる。さらに、人を雇うよりも安価だ。

生成AIは中間層を取り替えるポテンシャルを秘めている。もし中間層がAIに置き換えられたら、中間層の人間はどのようにキャリアを積めば良いのだろうか？　永遠の初心者として生き続けるほかにないのだろうか？

LLMを使う上で大切なことは、「動くからOK」で終わらせないことだと思う。なぜこのコードを実行すると、自分が思っていた通りに動いてくれるのか？　その構造や仕組みを理解することがこれからの人間にとって大事な能力になるのではないかと思っている。一つ一つのメソッドや命令文の意図を、自分なりの言葉で理解する。そして、自分でも自力で使えるように覚えておくこと。
%%
## できたはいいが使いづらい
そんなこんなで3日ほどかけて、ロングマン英英辞典の特定の例文から、単語帳に使うテキストを取得して、音声をダウンロードするChrome拡張機能ができあがった。

できあがった機能を少し使ってみて、改めて反省すべき点も見つかった。自分の中の要件を具体的に固まっていないと、中途半端なものができあがる。

この拡張機能が作るのは、Ankiの単語帳に突っ込む「表面」「裏面」それぞれのテキスト文面だ。これ自体は問題なく叶えられた。

ところが、実際に機能を使ってみると、思っていたよりも作業が効率的にならない。作業時間は2分から1分近くに短縮できた。それ自体は嬉しいが、もっと短くしたいという欲求がある。

そして、貼り付ける文章をプレーンテキストにしたせいで、手作業で作ったカードと比べて見劣りするようになってしまった。HTMLに描画された文章をコピペする場合、太文字の部分は太文字のまま、斜体の文字は斜体のまま貼り付けられる。そうした装飾部分が、現時点でのChrome拡張機能だと取り払ってしまう。

もちろん、出力する文字を太文字や斜体することは簡単だ。太文字にする文面を`<span style="font-size: bold"></span>`、斜体の文面を`<span style="font-style: italic"></span>`で囲んでしまえば、手作業で作った場合と同じ見た目にすることはできる。

しかし、嫌な予感がする。その方法で進めると何かがマズい気がする。[^嫌な予感]

[^嫌な予感]: しいて言えば「ひとつのデータが担っている役割・責任が多すぎる」ことへの嫌悪感。  
	今回の場合、①「裏面」に載せるデータの量と種類が多すぎること、②テキスト内に`<span>`タグを入れてカードの装飾をすること、この2点に対する懸念。[[📝単一責任の原則]]というものがあるように、機能やデータはただひとつの役割・責任だけを負う形に実装した方が扱いやすくなる。  
	この嫌な予感自体は「出力するのはカードの表面と裏面の文章」と決めた時点で感じていたが、まずは要件を叶えることが先決だと考えて無視していた。考えが甘かった。

## 今後の課題：Ankiのデッキから作り直そう
そこで、別のやり方で進めることにした。Ankiへデータをインポートする方法自体を変える。  
つまり、Anki用に出力するデータを「表面」「裏面」の2種類のデータにするのではなく、「例文」「例文音声」「日本語訳」「英単語」「英単語の発音記号」「英単語の発音音声」etc...という風に、出力するデータの構造を細かく分けることにした。この方法の利点はいくつかある。

一つ目は、自分の扱うデータが文字列だけになるので、データのインポートが楽になること。おそらくGoogle Spread Sheetで入力できる形にまでデータを構造化できれば、インポート作業がより楽になり、迅速になるかもしれない。

二つ目は、Ankiカードの装飾が楽になることだ。これまではAnkiカードのテキストにHTMLタグを直書きすることで見た目を装飾していた。言うなれば、テキストの装飾をCSSに任せず、全部HTMLファイル内で装飾しているようなものだ。

しかし、Ankiにはカードテンプレート機能がある。自分で新しいカードテンプレートを作成して、そのテンプレートに書式を設定すれば、その書式が対応するカード全てに適用される。カードの見た目を変えたければ、わざわざ全部のカードのHTMLタグをいじらなくても、テンプレートの書式ファイルだけを変えればいい。
## 終わりに
このように、Ankiのデータ自体を扱いやすい形に変形しておいた方が、例文カードの作成もより効率的に行えたはずだ。それをしなかったのは、ひとえに問題の範囲をロングマン英英辞典のWEBサイトだけに縮小させていたためだった。本当は、Ankiのデッキカードの構造を変えることも、検討すべきだった。

そんなわけで、今度はAnkiカードのリプレース案件が発生したのである。どうしたものか。