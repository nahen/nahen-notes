---
created: 2024-06-16
modified: 2024-12-11
tags: []
aliases: []
parents: 
---
%%ここ数ヶ月間、英語を勉強し続けている。LLMのような生成AIを効果的に使うには、英語が扱えた方がよいと思っているからだ。というのも、LLMを制作しているのは英語圏の企業であり、英語の言語データセットの量が一番多いというLLMも多数ある。それならば、英語を扱える人間になればLLMを効果的に扱えるのかもしれない。
なお、LLMが普及しない世の中になっても問題はない。英語が使えることは依然として有用なスキルの一つだろう。%%
## 英英辞典からAnkiカードを効率的に作りたい
現在は[[🌐Antimoon Method]]に則って、英語を勉強している。使うのは、ロングマン英英辞典に載っている例文とその日本語訳だ。  
これらの例文と音声を合わせて、単語帳アプリ[[🧰Anki]]に突っ込んでいる。そして時間がある時に、単語帳を繰るようにその例文集を繰って、例文や単語の意味を脳に覚え込ませようとしている。

今までは、このAnki用のカードを作る工程を手作業で行っていた。しかしカードを作る作業は思っていたよりも時間がかかる。そのため、プログラミングでこの作業を効率化できないかと考えた。
## Chrome拡張機能を作る
まずは、どうやってロングマン英英辞典のWEBサイトから、例文や例文音声、英単語とメタ情報を取得するか。

以前に似たようなWEBスクレイピングを行ったことがあり、その時はPythonとBeautiful Soupを使った。しかし今回、Pythonを使ってプログラミングをするのは少し大袈裟な気もする。[^finally]ブラウザを操作するつもりはないし、WEBページ全体をスクレイピングするつもりもないからだ。もし他に良い手法があるならば、そちらを実践したい。

[^finally]: 最終的には、WEBページ全体をスクレイピングする必要が出た。人間の予想はいつだって外れる。

一人で考えていても埒が明かないので、LLMに相談した。  
*「WEBサイトからテキストを抜き出すプログラムを書くのに適した言語はあるでしょうか？」*   
得られた返答の中に、JavaScriptを使うという案があった。そこから、Chrome拡張機能として作るという案が生まれた。

## 実装する機能
今回私が作りたいのは、以下の機能だ。
- *特定の* 例文を取得する
- 対象の例文が載っている英単語とその定義を取得する
- 例文の音声と、英単語の発音2種類をダウンロードする

普段作っているAnkiのカードは、覚えたい英単語に関連する例文をすべて取り込んでいるわけではない。その中でも一部の例文だけを取り込んでいる。[^なぜ特定のものだけ？]なので、載っている例文のうち、選択した一部だけを集めるという方法で進める。[^別の方法の方が良かったかも]  
英単語については、発音記号や品詞、活用や文法上の使い方など、付属する情報も取得したい。[^fuzui]

[^なぜ特定のものだけ？]: 基本的には、ロングマン英英辞典とロングマン和英辞典とで共通している例文を取り上げている。自分で考え出したり、Google翻訳で生み出した和訳よりも、辞書に載っている和訳の方が信頼できるからだ。しかし、和英辞典と英英辞典とで共通して載っている例文は少ない。一見同じ例文だが、よく見ると代名詞（he/she）や数値の単位（ドル/ポンド）が異なるパターンもある。
[^別の方法の方が良かったかも]: 機能を作成し終えてから、「あらかじめすべての例文を抽出してTSVファイルに出力し、使えそうな例文だけピックする」という手法を思いついた。初めからそうすればよかった。
[^fuzui]: この「付随する情報」が自分の思っていた以上に種類が多く、コードを書くときに苦労した。手作業でやっていた時は、ブラウザに写っているものを丸ごとコピーするだけで済んでいたのだが。

一方で、私は今までChrome拡張機能を作ったことがない。そこで、拡張機能の作り方をGoogleで調べて、出てきたサイトを参考にした。[^extention]

[^extention]: [Chrome拡張機能を作ってみる（基礎） - Qiita](https://qiita.com/komlabo/items/5b99d3598f6664621dae)

## LLMによる開発補助はとても便利
今回の開発作業で初めてLLMを使った。LLMはプログラマーをどこまでサポートできるのか、実際に試したかったからだ。今回使ったLLMはClaude3がメインである。ただし、Claude3の回答が心もとない場合はGeminiを使った。

まずは、ロングマン英英辞典のHTMLの一部をコピーして貼り付ける。そして、そのHTMLから特定のClass名を持つタグのテキストを抽出するコードを書くようにLLMに頼んだ。  

何度かやりとりをして得られた感想は、「思っていたよりもすごい」だった。探索対象のHTMLと、そのHTMLから何を得たいか。それらを日本語で伝えるだけで、LLMは使えそうなJavaScriptコードをすぐに生成してくれる。その速度は私の知る中で誰よりも早い。私はコードを書くのが非常に遅いので、光の速さで置き去りにされてしまった。

一方で、たった一回の応答で完璧なコードが生成できるわけではない。LLMが出力したコードを実行しても、エラーが出たり、想定とは違う形でテキストを取得してきたり、明らかに不要なプラグインを使おうとしたりする。

幸い、そんな場合でも楽に修正できる。エラーメッセージ等を余さずLLMに伝えて、修正するように指示するだけでいい。それだけでLLMは、要求を叶えるコードを新たに生成してくれる。

たった一回で完璧なコードが作れないのは不便だが、これは当然といえば当然だ。LLMの性能が悪いのではない。むしろそれ以前、つまり私自身の問題なのだから。

少なくとも私は、たった一回でLLMが完璧に働くような指示が出せない。なぜなら、*自分が作りたいものの要件を具体的に定義できていない* からだ。

LLMとのやりとりを続ければ続けるほど、自分の要件の穴が見えてくる。作るうえで必要な前提が言語化できていなかったり、「これは説明しなくてもわかるだろう」と思って重要な説明を端折ったりしてしまう。

LLMにコードを出力してもらう上で大事なことは、*自分が作りたいモノの仕様を文章の形で具体的に固める* ことだ。しかし、よほど経験を積んだ人か[スマブラを作った人](https://ja.wikipedia.org/wiki/%E6%A1%9C%E4%BA%95%E6%94%BF%E5%8D%9A)でない限り、自分の頭の中だけで仕様を完全に固めるのは難しい。

そのときは、LLMと対話を繰り返そう。対話を繰り返して自分の要件の穴を埋めながら、コードを少しずつ自分の理想の形に近づけていく。自分自身が言語化ができていないのに、たった一回の指示だけで完璧なコードを作れると考えてはならない。

%%要件を定義することは難しい。多くの場合、LLMが思っていたようなコードを生成してくれないのは、LLMが悪いというよりはむしろ自分の指示が悪いことが原因だ。前提条件を伝えなかったせいで、Chrome拡張機能で使えないプラグインを使いだす。本当は「音声が存在する例文」だけを取得するのが要件なのに、その説明を省いて「例文」とだけ伝えたせいで、コーパス内の文章まで集めようとする。こうして説明の、主に不足によって、LLMは自分の想定とは違うコードを作り出してしまう。%%

また、LLMが生成するコードは品質がそこそこ良い。少なくとも、プログラミング初心者が書くコードより綺麗だ。回答によっては、今の私より良いコードを書く場合もある。そちらの方が怖い。[^私はオブジェクト志向が書けない]

[^私はオブジェクト志向が書けない]: プログラマーとして数年働いてきたのに、私はオブジェクト志向を十分に理解できていない。これまで書いてきたコードも、オブジェクト志向というより手続き型に近い。

%%
生成AIが広まることで置き換えられる可能性が高いのは、私のように実務経験が数年程度の中間層だと思う。生成AIは初心者に優しい。何をすればよいかわからなければ、生成AIはステップごとの進め方を教えてくれる。質問があれば四六時中いつでも答えてくれる。
一方で、上級者が生成AIから技術を教わることはあまりない。しかし、自身の得意分野以外の面で生成AIを活用できる。形而上的なアイデアについて生成AIと壁打ちをすれば、自分の考えの補強・穴埋めを効果的に進められる。

ところが、中間層はそのどちらの恩恵も受け取りづらい。初心者よりは知識や経験があるため、何か困ったことがあっても自力で解決しようとするので、生成AIを頼りづらい。そして上級者ほど知識や経験があるわけではないので、生成AIにアイデアを伝えようとしても、漠然としたものになりやすい。（本当か？）

その上で、生成AIが生み出すコードの品質は中級者に近い。しかも、中級者よりも早く、正確に、大量のコードを生み出してくれる。さらに、人を雇うよりも安価だ。

生成AIは中間層を取り替えるポテンシャルを秘めている。もし中間層がAIに置き換えられたら、中間層の人間はどのようにキャリアを積めば良いのだろうか？　永遠の初心者として生き続けるほかにないのだろうか？

LLMを使う上で大切なことは、「動くからOK」で終わらせないことだと思う。なぜこのコードを実行すると、自分が思っていた通りに動いてくれるのか？　その構造や仕組みを理解することがこれからの人間にとって大事な能力になるのではないかと思っている。一つ一つのメソッドや命令文の意図を、自分なりの言葉で理解する。そして、自分でも自力で使えるように覚えておくこと。
%%
## できたはいいが使いづらい
そんなこんなで3日ほどかけて、目当てのChrome拡張機能ができあがった。ロングマン英英辞典に載っている特定の例文から、Ankiの単語帳に突っ込む「表面」「裏面」それぞれのテキスト文面を作成して取得する。ついでに例文の音声もダウンロードする。

ところが、実際に拡張機能を使ってみると、思ったよりも作業が効率的にならない。確かに作業時間は2分から1分へと短くなった。しかし、もっと短くしたいという欲求がある。

また、貼り付ける文面をプレーンテキストにしたせいか、作ったカードが手作業のものよりも見劣りしてしまった。HTMLに描画された文章の場合、コピーしてAnkiに貼り付けると、太文字は太文字のまま、斜体は斜体のまま貼り付けることができる。そうした装飾が、このChrome拡張機能だと取り払われてしまう。

出力する文字を太文字や斜体にするのは簡単だ。太文字の文面は`<span style="font-size: bold"></span>`、斜体の文面は`<span style="font-style: italic"></span>`で囲むようにプログラムを書き直せばいい。そうすれば、手作業で作ったカードと同じ見栄えにできる。  
しかし、嫌な予感がする。その方法で進めると何かがマズい気がする。[^bad-feeling]

[^bad-feeling] しいて言えば「ひとつのデータが担う役割・責任が多すぎる」ことへの嫌悪感。  
	今回の場合、①「裏面」に載せるデータの量と種類が多すぎること、②テキスト内に`<span>`タグを入れてカードの装飾をすること、この2点に対する懸念。[[📝単一責任の原則]]というものがあるように、機能やデータはただひとつの役割・責任だけを負う形に実装した方が扱いやすくなる。  
	この嫌な予感は「出力するのはカードの表面と裏面の文章」と決めた時点で感じていたが、要件を叶えることが先決と決めて無視していた。考えが甘かった。

## Ankiのデッキから作り直す
そこで、別のやり方で進めることにした。Ankiにデータをインポートする方法自体を変える。  つまり、Anki用に入力するデータの構造（Ankiでいう[フィールド](https://wikiwiki.jp/rage2050/2.0/AddingMaterial#customizing-fields)）を変えて、以下のように細かく分けることにした。

- これまでのAnkiに入力するデータ
	- 表面の文章
	- 裏面の文章
- 今後Ankiに入力するデータ
	- 例文
	- 例文音声
	- 日本語訳
	- 覚えたい英単語
	- 英単語の発音記号
	- 英単語の発音音声
	- etc...

この方法には利点が二つある。一つ目は、自分の扱うデータが文字列だけになり、データのインポートが楽になることだ。スプレッドシートで作れる形にまでデータを構造化できれば、カードの作成もインポートも楽になり、作業も速くできるかもしれない。

二つ目は、Ankiカードの装飾が楽になることだ。これまではAnkiカードにHTMLタグを直書きすることで見た目を装飾していた。いわば、テキストの装飾をCSSに任せず、全部HTMLファイル内に直書きしているようなものだ。

しかし、Ankiには[カードテンプレート機能](https://wikiwiki.jp/rage2050/2.0/CardsAndTemplates)がある。自分で新しいカードテンプレートを作成して、そのテンプレートに書式を設定することで、対応するカード全てに設定した書式が適用される。カードの見た目を変えたくなっても、わざわざ全部のカードのHTMLタグをいじらずに済む。テンプレートの書式ファイルだけを変えればいい。

## 終わりに
結果的に、今回の拡張機能の作成は失敗に終わった。

手作業でやっていた手順をプログラムで再現すればよいと思って実施したが、あまり効果はなかった。それよりも必要なのは、作業手順を見直して、Ankiにインポートするデータの構造自体を作り替えることだった。

この考えに至らなかったのは、ひとえに問題の範囲をロングマン英英辞典のWEBサイトだけに縮めていたためだった。本当はAnki自体にまで範囲を広げて、Ankiの例文カードを構造から変えることを検討すべきだった。

[[🦾現在は英英辞典例文のカードをカードテンプレートで作っている]]。